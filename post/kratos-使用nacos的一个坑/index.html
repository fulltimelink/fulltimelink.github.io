<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kratos 使用nacos服务发现的一个坑 | 旧事重提</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.101.0" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="fulltimelink">
<meta name="keywords" content="go">
<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />




<meta property="og:title" content="Kratos 使用nacos服务发现的一个坑" />
<meta property="og:description" content="接上回，经过几天的搬砖，转码服务要上预发布了，因为服务器部署的注册中心是nacos
所以把kratos的registry改为nacos
编译-&gt; 镜像-&gt; nodeport测试
nacos心跳探针一直报错。。提示无可用的注册服务
对比consul的注册服务名发现nacos下注册的服务名多了scheme后缀
追一下kratos 下 consul和nacos注册服务时的代码
nacos确实注册时附加了scheme, 所以rpc licent call的时候，服务名也需要加上对应的.scheme~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://fulltime.link/post/kratos-%E4%BD%BF%E7%94%A8nacos%E7%9A%84%E4%B8%80%E4%B8%AA%E5%9D%91/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-04-11T16:51:19+08:00" />
<meta property="article:modified_time" content="2022-04-11T16:51:19+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kratos 使用nacos服务发现的一个坑"/>
<meta name="twitter:description" content="接上回，经过几天的搬砖，转码服务要上预发布了，因为服务器部署的注册中心是nacos
所以把kratos的registry改为nacos
编译-&gt; 镜像-&gt; nodeport测试
nacos心跳探针一直报错。。提示无可用的注册服务
对比consul的注册服务名发现nacos下注册的服务名多了scheme后缀
追一下kratos 下 consul和nacos注册服务时的代码
nacos确实注册时附加了scheme, 所以rpc licent call的时候，服务名也需要加上对应的.scheme~"/>

<meta itemprop="name" content="Kratos 使用nacos服务发现的一个坑">
<meta itemprop="description" content="接上回，经过几天的搬砖，转码服务要上预发布了，因为服务器部署的注册中心是nacos
所以把kratos的registry改为nacos
编译-&gt; 镜像-&gt; nodeport测试
nacos心跳探针一直报错。。提示无可用的注册服务
对比consul的注册服务名发现nacos下注册的服务名多了scheme后缀
追一下kratos 下 consul和nacos注册服务时的代码
nacos确实注册时附加了scheme, 所以rpc licent call的时候，服务名也需要加上对应的.scheme~"><meta itemprop="datePublished" content="2022-04-11T16:51:19+08:00" />
<meta itemprop="dateModified" content="2022-04-11T16:51:19+08:00" />
<meta itemprop="wordCount" content="14">
<meta itemprop="keywords" content="go," />
</head>
<body>
<header>
<div id="titletext">
<h2 id="titleonly"><a href="http://fulltime.link/">旧事重提</a></h2>
</div>
<div id="title-social">
</div>
<div id="mainmenu">
<nav>
<ul>
<li><a href="/tags/algorithm">Algorithm</a></li>
<li><a href="/tags/go">Go</a></li>
<li><a href="/tags/h5">H5</a></li>
<li><a href="/tags/java">Java</a></li>
<li><a href="/tags/javascript">Javascript</a></li>
<li><a href="/tags/kubernetes">Kubernetes</a></li>
<li><a href="/tags/linux">Linux</a></li>
<li><a href="/tags/php">Php</a></li>
</ul>
</nav>
</div>
</header>
<main>
<div class="post">
<article>
<div class="post-header">
<div class="meta">
<div class="date">
<span class="day">11</span>
<span class="rest">Apr 2022</span>
</div>
</div>
<div class="matter">
<h1 class="title">Kratos 使用nacos服务发现的一个坑</h1>
<p class="post-meta">
<span class="post-meta">





<i class="fas fa-user"></i>&nbsp;

fulltimelink



</span>

</p>
</div>
</div>
<div class="markdown">
<p>接上回，经过几天的搬砖，转码服务要上预发布了，因为服务器部署的注册中心是nacos</p>
<p>所以把kratos的registry改为nacos</p>
<p>编译-&gt; 镜像-&gt; nodeport测试</p>
<p>nacos心跳探针一直报错。。提示无可用的注册服务</p>
<p>对比consul的注册服务名发现nacos下注册的服务名多了scheme后缀</p>
<p><figure>
  <img src="/20220411/1.jpg" alt="坑"  />
</figure></p>
<p>追一下kratos 下 consul和nacos注册服务时的代码</p>
<p><figure>
  <img src="/20220411/2.jpg" alt="坑"  />
</figure></p>
<p>nacos确实注册时附加了scheme, 所以rpc licent call的时候，服务名也需要加上对应的.scheme~</p>
<hr>
<p><figure>
  <img src="/20220411.jpg" alt="图"  />
</figure></p>

</div>
<div class="tags">
<div class="taxosfloating_left">
<p>Tags</p>
</div>
<div class="termsfloating_right">
<p>
<a href="/tags/go/">go</a>
</p>
</div>
<div class="clearit"></div>
</div>
</article>
</div>
</main><script src="/js/dark-mode.js"></script>

</body>
</html>
